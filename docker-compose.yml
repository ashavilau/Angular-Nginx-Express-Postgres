version: '3.1'

services:
        frontend:
                container_name: frontend
                depends_on:
                        - database 
                        - backend
                image: frontend
                network_mode: service:database
                build:
                        context: ./frontend
                        dockerfile: Dockerfile
                environment:
                        - NODE_ENV=production
        database: 
                container_name: db
                image: postgres:alpine
                environment:
                        - POSTGRES_USER=user
                        - POSTGRES_PASSWORD=secure1
                        - POSTGRES_DB=db
                ports:
                        - "5432:5432"
                        - "3000:3000"
                        - "80:80"
        backend:
                container_name: backend
                image: backend
                network_mode: service:database
                depends_on:
                        - database
                build:
                        context: ./backend
                        dockerfile: Dockerfile
                environment:
                        - NODE_ENV=production
                        - DB_CONNECTION=postgres://user:secure1@database/db